## CPU上下文切换的分类
1. 进程上下文切换
2. 线程上下文切换
3. 中断上下文切换

## 进程上下文切换

1. 进程运行空间分为内核空间和用户空间，当进程在内核空间运行为内核态，在用户空间运行为用户态
2. 用户态到内核态的转变需要系统调用来完成，系统调用过程一直是同一个进程在运行，
3. 系统调用过程通常称为特权模式切换，而不是上下文切换，但实际，在系统调用过程中，CPU的上下文切换是无法避免的

### 进程上下文切换与系统调用的区别
	首先进程是由内核来管理和调度的，进程的切换只能发生在内核态，所以，进程上下文不仅保罗了虚拟内存，栈，全局变量等用户空间的资源，还包括了内核堆栈，寄存器等内核空间的状态
	因此进程上下文切换比系统调用多了一步

### 触发进程调度的时机
	1.进程调度算法为每个进程分配了相同的运行时间片段，当时间耗尽的时候，相应进程被挂起，切换其他进程运行
	2.进程在系统资源不足时，要等到资源满足后才可以运行，这个时候也会被挂起。
	3.当进程通过睡眠函数sleep这样的方法主动将自己挂起时
	4.当有更高级优先级的进程运行时
	5.发生硬件终端时

## 线程上下文切换
分为同进程内的和不同进程间的上下文切换，其中不同进程间的线程上下文切换同进程上下文切换相同，同进程间的上下文切换，由于共用了进程的相关共用资源，因此此共用的部分不许需要保存切换，需要保存的仅仅是线程的独立栈和寄存器等。最终的内核中的任务调度，实际上的调度对象是线程，而进程仅仅提供了虚拟内存，全局变量等资源

### 线程与进程的区别：
	1.进程是资源拥有的基本单位，线程是调度的基本单位。
	2.当进程只有一个线程时，可以任务进程就等于线程
	3.当进程拥有多个线程时，这些线程会共享相同的虚拟内存和全局变量等资源
	4.线程也有自己的私有数据，比如栈和寄存器

## 中断上下文切换
中断处理通常会打断进程的正常调度和执行，转而调用中断处理程序
	1.中断上下文切换不会涉及到进程的用户态。中断上下文，只包括了内核态中断服务程序执行所必须的状态，包括CPU寄存器，内核堆栈，硬件终端参数等
	2.对同一个CPU来说，终端处理比进程有更高的优先级

## 扩展 

### CPU中主要寄存器及其作用

1. 数据寄存器（Data Register，DR）：作为CPU和主存、外设之间信息传输的中转站，用以弥补CPU和主存、外设之间操作速度上的差异，在单累加器结构的运算器中，数据寄存器还可兼作操作数寄存器

2. 指令寄存器（Instruction Register，IR）：用来保存当前正在执行的一条指令，当执行一条指令时，首先把该指令从主存读取到数据寄存器中，然后再传送至指令寄存器，指令包括操作码和地址码两个字段，其中指令译码器（Instruction Decoder，ID）主要是对操作码进行测试，识别出所要求的操作，以产生指令所要求的操作控制电位。指令寄存器中操作码字段的输出就是指令译码器的输入。

3. 程序计数器（Program Counter，PC）用来指出下一条指令在主存储器中的地址，在程序执行之前，首先必须将程序的首地址，即程序第一条指令所在主存单元的地址送入PC，因此PC的内容即时从主存提取的第一条指令的地址。当执行指令时，CPU能自动递增PC的内容，使其时钟保存将要执行的下一条指令的主存地址，为取下一条指令做好准备。当遇到转移指令时，下一条指令的地址酱油转移指令的地址码字段来指定。因此程序计数器的结构应当是具有寄存信息和计数两种功能的结构

4. 地址寄存器（Address Register，AR）用来保存CPU当前所访问的主存单元的地址。当CPU和主存进行信息交换，即读取或者存储时，都要使用地址寄存器和数据寄存器

5. 累加寄存器（Accumulator，AC），简称累加器是一个通用寄存器。当运算器的算术逻辑单元ALU执行算术或逻辑运算时，为ALU提供一个工作区，可以为ALU暂时保存一个操作数或运算结果。

6. 程序状态字（Program Status Word，PSW）用来表征当前运算的状态及程序的工作方式。程序状态字寄存器用来保存由算术/逻辑指令运行或测试的结果所建立起来的各种条件码内容，如运算结果进/借位标志（C）、运算结果溢出标志（O）、运算结果为零标志（Z）、运算结果为负标志（N）、运算结果符号标志（S）等，这些标志位通常用1位触发器来保存。除此之外，程序状态字寄存器还用来保存中断和系统工作状态等信息，以便CPU和系统及时了解机器运行状态和程序运行状态。因此，程序状态字寄存器是一个保存各种状态条件标志的寄存器。

###  Linux进程地址空间
主要包括用户空间和内核空间，其中的分类，可参考 [Linux的进程地址空间](https://zhuanlan.zhihu.com/p/66794639)

### Linux中的TLB
Linux上的虚拟内存到物理内存的映射关系 可参考 [TLB是什么](https://zhuanlan.zhihu.com/p/79607142)





